你的Rule（必须遵守的编程准则）
Rule 1: 配置外置原则
所有可变参数必须放入YAML/JSON配置文件
禁止代码中出现任何硬编码路径、密钥、模型名
配置文件变更无需重启即可生效（热重载）
Rule 2: 多模型后端兼容原则
默认支持OpenRouter（base_url="https://openrouter.ai/api/v1"）
必须兼容阿里云百炼（base_url="https://dashscope.aliyuncs.com/compatible-mode/v1"）
支持通义千问系列（qwen-max、qwen-plus、qwen-turbo）
标准OpenAI接口作为可选项
密钥从环境变量或配置文件读取，禁止代码硬编码
Rule 3: 提示词文件化原则
所有LLM提示词必须存放在独立文件（prompts/目录）
system、user、examples分离，支持动态组装（Jinja2）
提示词支持变量渲染（{{variable}}）
Rule 4: 失败优雅降级原则
LLM调用失败自动重试（指数退避，最多3次）
响应格式错误生成备用内容（fallback）
单节点失败不中断整体流程（LangGraph中断点继续）
Rule 5: LangGraph状态机原则
必须使用LangGraph StateGraph构建Agent，禁止裸调LLM链
状态Schema必须类型化（TypedDict），禁止随意dict传参
必须使用Checkpointer（MemorySaver或PostgresSaver）实现检查点
支持任意步骤断点保存与恢复（interrupt/resume）
Rule 6: 状态可观测原则
每步状态变更打印结构化日志（含thread_id与node_name）
关键决策节点（工具调用、LLM输出）必须埋点
LangGraph图结构可视化导出（Mermaid或PNG）
Rule 7: 物理分离与模块化原则（新增）
禁止代码堆砌，强制文件级关注点分离
单一文件职责：一个文件只定义一个LangGraph节点（Node）或一个工具（Tool），禁止一个文件定义多个类/函数
禁止God File：主逻辑文件（graph.py）不得超过200行，工具文件不得超过150行，超限必须拆分
强制目录结构：
plain
复制
src/
├── agents/               # Agent定义
│   ├── nodes/            # 每个节点一个文件（planner.py、executor.py、critic.py）
│   ├── edges/            # 条件边逻辑（routing.py）
│   ├── state.py          # TypedDict状态定义唯一位置
│   └── graph.py          # 图构建入口（仅负责组装，不包含业务逻辑）
├── tools/                # 工具实现
│   ├── search.py         # 每个工具独立文件
│   └── calculator.py
├── prompts/              # Jinja2模板（Rule 3）
├── config/               # YAML配置（Rule 1）
└── utils/                # 纯工具函数（与业务无关）
显式注册机制：Tools和Nodes必须通过装饰器（@register_tool、@register_node）显式注册，禁止自动扫描或魔法import
依赖方向强制：agents -> tools -> utils，禁止反向依赖，禁止循环导入
Rule 7: 状态可观测原则
每步状态变更打印结构化日志（含thread_id与node_name）
关键决策节点（工具调用、LLM输出）必须埋点
LangGraph图结构可视化导出（Mermaid或PNG）

Rule 8: 环境标准化原则（UV-First）
强制使用uv作为唯一环境管理器，禁止pip/poetry/conda混用
包管理：统一使用uv pip install / uv add，禁止直接使用pip
依赖声明：仅使用pyproject.toml管理依赖，禁止requirements.txt
版本锁定：必须提交uv.lock文件到Git，确保构建100%可复现
虚拟环境：固定使用.venv目录（uv默认），通过uv run或.venv/bin/python执行，禁止全局Python安装依赖
Python版本：固定Python版本在.python-version和pyproject.toml的requires-python字段
脚本入口：所有CLI命令定义在pyproject.toml的[project.scripts]，使用uv run <command>执行，禁止手动写bash脚本
开发工作流：使用uv run直接运行代码，无需手动激活虚拟环境